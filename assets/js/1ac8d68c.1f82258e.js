"use strict";(self.webpackChunkxing_life_3=self.webpackChunkxing_life_3||[]).push([[7373],{2065:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var s=t(4848),i=t(8453);const r={},l="let's Encrypt",c={id:"technique/web_server/lets_encrypt",title:"let's Encrypt",description:"reference//letsencrypt.org/",source:"@site/docs/technique/web_server/lets_encrypt.md",sourceDirName:"technique/web_server",slug:"/technique/web_server/lets_encrypt",permalink:"/docs/technique/web_server/lets_encrypt",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"techniqueSidebar",previous:{title:"DDNS",permalink:"/docs/technique/web_server/ddns"},next:{title:"Nginx",permalink:"/docs/technique/web_server/nginx"}},o={},a=[{value:"Step 1. install certbot",id:"step-1-install-certbot",level:2},{value:"Step 2. edit nginx config",id:"step-2-edit-nginx-config",level:2},{value:"Step 3. apply a certificate",id:"step-3-apply-a-certificate",level:2},{value:"Step 4. create a 2048-bit Diffie-Hellman combine for getting more security",id:"step-4-create-a-2048-bit-diffie-hellman-combine-for-getting-more-security",level:2},{value:"Step 5. set up ssl-domain.com.conf",id:"step-5-set-up-ssl-domaincomconf",level:2},{value:"Step 6. apply diffie-hellman",id:"step-6-apply-diffie-hellman",level:2},{value:"Step 7. enable ssl",id:"step-7-enable-ssl",level:2},{value:"method 1 using return",id:"method-1-using-return",level:3},{value:"method 2 using rewrite (recommend)",id:"method-2-using-rewrite-recommend",level:3},{value:"Auto update cerfiticate",id:"auto-update-cerfiticate",level:2},{value:"Delete Certbot Certificate by Domain Name",id:"delete-certbot-certificate-by-domain-name",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"lets-encrypt",children:"let's Encrypt"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["reference: ",(0,s.jsx)(n.a,{href:"https://letsencrypt.org/",children:"https://letsencrypt.org/"})]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://xenby.com/b/101-%E6%95%99%E5%AD%B8-%E7%94%B3%E8%AB%8Blets-encrypt%E6%86%91%E8%AD%89%E8%88%87%E5%95%9F%E7%94%A8https-nginx",children:"https://xenby.com/b/101-%E6%95%99%E5%AD%B8-%E7%94%B3%E8%AB%8Blets-encrypt%E6%86%91%E8%AD%89%E8%88%87%E5%95%9F%E7%94%A8https-nginx"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-1-install-certbot",children:"Step 1. install certbot"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo add-apt-repository ppa:certbot/certbot\n$ sudo apt-get update\n$ sudo apt-get install certbot\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-2-edit-nginx-config",children:"Step 2. edit nginx config"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo vim /etc/nginx/sites/sites-available/default # or another wanted\n\n>>>>>\n\nlocation ~ /.well-known {\n\tallow all;\n}\n\n<<<<<\n\n$ sudo service nginx reload\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-3-apply-a-certificate",children:"Step 3. apply a certificate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo certbot certonly --webroot --webroot-path=/var/www/projectDir -d domain.com -d www.domain.com -d subDomainName.domain.com\n\nnext step will key email.\nif would not enter email, add parameter: \u2013register-unsafely-without-email\nit will put file at /etc/letsencrypt/live/www.domain.com/fullchain.pem\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-4-create-a-2048-bit-diffie-hellman-combine-for-getting-more-security",children:"Step 4. create a 2048-bit Diffie-Hellman combine for getting more security"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048\nit will at /etc/ssl/certs/dhparam.pem\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-5-set-up-ssl-domaincomconf",children:"Step 5. set up ssl-domain.com.conf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo vim /etc/nginx/snippets/ssl-domain.com.conf\n\n>>>>>\n\nssl_certificate /etc/letsencrypt/live/domain.com/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/domain.com/privkey.pem;\n\n<<<<<\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-6-apply-diffie-hellman",children:"Step 6. apply diffie-hellman"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'$ sudo vim /etc/nginx/snippets/ssl-params.conf\n\n>>>>>\n\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\nssl_prefer_server_ciphers on;\nssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";\nssl_ecdh_curve secp384r1;\nssl_session_cache shared:SSL:10m;\nssl_session_tickets off;\nssl_stapling on;\nssl_stapling_verify on;\nresolver 8.8.8.8 8.8.4.4 valid=300s;\nresolver_timeout 5s;\nadd_header X-Frame-Options DENY;\nadd_header X-Content-Type-Options nosniff;\nssl_dhparam /etc/ssl/certs/dhparam.pem;\n\n<<<<<\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e2d\u76848.8.8.8 8.8.4.4\u8207/etc/ssl/certs/dhparam.pem\u53ef\u4ee5\u4f9d\u64da\u81ea\u5df1\u4f7f\u7528\u4e0d\u540c\u505a\u8a2d\u5b9a"}),"\n",(0,s.jsx)(n.p,{children:"8.8.8.8 8.8.4.4 \u70baGoogle DNS\u7684IP \u5047\u5982\u8981\u4f7f\u7528\u5225\u7684DNS\u5c31\u6539\u6210\u81ea\u5df1\u4f7f\u7528\u7684DNS IP"}),"\n",(0,s.jsx)(n.p,{children:"\u800c/etc/ssl/certs/dhparam.pem\u662f\u525b\u525b\u7522\u751f\u76842048-bit Diffie-Hellman\u7684\u5bc6\u78bc\u7d44\u5408\u4f4d\u7f6e \u5982\u679c\u4f60\u5728\u7522\u751f\u6642\u4e0d\u662f\u653e\u5728\u6b64\u8def\u5f91 \u5c31\u4fee\u6539\u9019\u500b\u9078\u9805"}),"\n",(0,s.jsx)(n.h2,{id:"step-7-enable-ssl",children:"Step 7. enable ssl"}),"\n",(0,s.jsx)(n.h3,{id:"method-1-using-return",children:"method 1 using return"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"listen 443 ssl http2 default_server;\nlisten [::]:443 ssl http2 default_server;\ninclude snippets/ssl-domain.com.conf;\ninclude snippets/ssl-params.conf;\n\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n    server_name domain.com www.domain.com;\n    return 301 https://$server_name$request_uri;\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-2-using-rewrite-recommend",children:"method 2 using rewrite (recommend)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"rewrite ^(.*) https://$host$1 permanent;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"auto-update-cerfiticate",children:"Auto update cerfiticate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'$ sudo crontab -e\n* * */7 * * /usr/bin/certbot renew --quiet --renew-hook "/bin/systemctl reload nginx"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"delete-certbot-certificate-by-domain-name",children:"Delete Certbot Certificate by Domain Name"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo certbot delete --cert-name www.domain.com\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>c});var s=t(6540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);