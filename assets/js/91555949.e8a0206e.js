"use strict";(self.webpackChunkxing_life_3=self.webpackChunkxing_life_3||[]).push([[6072],{3125:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>o});var a=t(4848),i=t(8453);const s={},d="TFkeras",r={id:"technique/TFkeras/README",title:"TFkeras",description:"\u96dc\u4e03\u96dc\u516b",source:"@site/docs/technique/TFkeras/README.md",sourceDirName:"technique/TFkeras",slug:"/technique/TFkeras/",permalink:"/docs/technique/TFkeras/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"techniqueSidebar",previous:{title:"Notes",permalink:"/docs/technique/"},next:{title:"\u6df1\u5ea6\u795e\u7d93\u7db2\u8defDNN",permalink:"/docs/technique/TFkeras/dnn"}},l={},o=[{value:"\u96dc\u4e03\u96dc\u516b",id:"\u96dc\u4e03\u96dc\u516b",level:2},{value:"keras",id:"keras",level:2},{value:"kaggle",id:"kaggle",level:2},{value:"overfit, underfit",id:"overfit-underfit",level:2},{value:"\u8cc7\u6599\u884c\u5217",id:"\u8cc7\u6599\u884c\u5217",level:2},{value:"2D Tensor \u7684\u904b\u7b97\uff0c\u5728Eager Execution\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u6df7\u548c Tensor \u548c Numpy \u505a\u904b\u7b97",id:"2d-tensor-\u7684\u904b\u7b97\u5728eager-execution\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u6df7\u548c-tensor-\u548c-numpy-\u505a\u904b\u7b97",level:2},{value:"tf.GradientTape()",id:"tfgradienttape",level:2},{value:"numpy, pandas \u4e0d\u80fd\u7528GPU\u52a0\u901f",id:"numpy-pandas-\u4e0d\u80fd\u7528gpu\u52a0\u901f",level:2},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:2},{value:"import \u5fc5\u8981\u5957\u4ef6",id:"import-\u5fc5\u8981\u5957\u4ef6",level:2},{value:"Sequential Model",id:"sequential-model",level:2},{value:"Single input model: \u55ae\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",id:"single-input-model-\u55ae\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",level:3},{value:"Multi Input Model: \u591a\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",id:"multi-input-model-\u591a\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",level:3},{value:"Multi Output Network: \u55ae\u8f38\u5165\u591a\u8f38\u51fa\u6a21\u578b",id:"multi-output-network-\u55ae\u8f38\u5165\u591a\u8f38\u51fa\u6a21\u578b",level:3},{value:"Multi Input and Multi Output Network",id:"multi-input-and-multi-output-network",level:3}];function p(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"tfkeras",children:"TFkeras"})}),"\n",(0,a.jsx)(e.h2,{id:"\u96dc\u4e03\u96dc\u516b",children:"\u96dc\u4e03\u96dc\u516b"}),"\n",(0,a.jsx)(e.p,{children:"TF data set \u53ef\u4ee5\u7528GPU\u52a0\u901f\nkeras vs pytorch"}),"\n",(0,a.jsx)(e.h2,{id:"keras",children:"keras"}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://keras.io/",children:"https://keras.io/"})}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"kaggle",children:"kaggle"}),"\n",(0,a.jsx)(e.p,{children:"\u5b78\u7fd2\u53c3\u8003"}),"\n",(0,a.jsx)(e.h2,{id:"overfit-underfit",children:"overfit, underfit"}),"\n",(0,a.jsx)(e.p,{children:"overfitting -> \u6b7b\u80cc\n\u628a\u96dc\u8a0a\u90fd\u8a18\u4e0b\u4e86\uff0c\u5c0e\u81f4\u8fa8\u8b58\u592a\u5439\u6bdb\u6c42\u75b5"}),"\n",(0,a.jsx)(e.p,{children:"underfitting -> \u5065\u5fd8\n\u8fa8\u8b58\u7387\u4e0d\u5920"}),"\n",(0,a.jsx)(e.h2,{id:"\u8cc7\u6599\u884c\u5217",children:"\u8cc7\u6599\u884c\u5217"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'x = tf.constant([[1, 2, 3, 4, 5, 6]])\nprint(x)\nprint("{}\u968eTensor ".format(x.ndim))\n\n# tf.Tensor([[1 2 3 4 5 6]], shape=(1, 6), dtype=int32)\n# \u4e00\u500brow \u516d\u500bcolumn\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'x = tf.constant([[1, 2, 3], [4, 5, 6]])\nprint(x)\nprint("{}\u968eTensor ".format(x.ndim))    # \u986f\u793aTensor\u7684\u7dad\u5ea6\n\n# tf.Tensor([[1 2 3] [4 5 6]], shape=(2, 3), dtype=int32)\n# \u5169\u500brow \u4e09\u500bcolumn\n'})}),"\n",(0,a.jsx)(e.h2,{id:"2d-tensor-\u7684\u904b\u7b97\u5728eager-execution\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u6df7\u548c-tensor-\u548c-numpy-\u505a\u904b\u7b97",children:"2D Tensor \u7684\u904b\u7b97\uff0c\u5728Eager Execution\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u6df7\u548c Tensor \u548c Numpy \u505a\u904b\u7b97"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'a = tf.constant([[1., 2.], [3., 4.]], dtype=tf.float32)\nb = np.array([[1., 0.], [2., 3.]], dtype=np.float32)\nprint("a constant: {}D Tensor".format(a.ndim))\n\nc = a + b\nprint(c)\nprint("a + b = \\n{}".format(c))\nd = tf.matmul(a, b)  # \u8ddf a*b \u662f\u4e0d\u4e00\u6a23\u7684\u6771\u897f\nprint("a dot b = \\n{}".format(d))\ne = a*b\nprint("a * b = \\n{}".format(e))\nf = tf.multiply(a, b) # \u8ddf a*b \u662f\u4e00\u6a23\u7684\u6771\u897f\nprint("a * b = \\n{}".format(f))\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u8f38\u51fa\u7684\u7d50\u679c\u70ba Tensor \u683c\u5f0f\uff0c\u6211\u5011\u53ef\u4ee5\u5c07\u5b83\u8f49\u70ba Numpy \u683c\u5f0f"}),"\n",(0,a.jsx)(e.h2,{id:"tfgradienttape",children:"tf.GradientTape()"}),"\n",(0,a.jsx)(e.p,{children:"\u8a08\u7b97Gradient(\u68af\u5ea6\u3001\u659c\u7387\u3001\u5fae\u5206)"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"w = tf.Variable([[1.0]])\nwith tf.GradientTape() as tape:\n    loss = w * w\n\ngrad = tape.gradient(loss, w)\nprint(grad)\nprint(loss)\n"})}),"\n",(0,a.jsx)(e.h2,{id:"numpy-pandas-\u4e0d\u80fd\u7528gpu\u52a0\u901f",children:"numpy, pandas \u4e0d\u80fd\u7528GPU\u52a0\u901f"}),"\n",(0,a.jsx)(e.p,{children:"!!!!!"}),"\n",(0,a.jsx)(e.h2,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:"tf.data.Dataset.from_tensors"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"dataset = tf.data.Dataset.from_tensors(tf.constant([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]))\nprint(dataset)\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"2",children:["\n",(0,a.jsx)(e.li,{children:"tf.data.Dataset.from_tensor_slices"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"x_data = tf.data.Dataset.from_tensor_slices(tf.constant([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]))\nprint(x_data)\n\ny_data = tf.data.Dataset.from_tensor_slices(tf.constant([0, 2, 4, 6, 8, 10, 12, 14, 16, 18]))\nprint(y_data)\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"3",children:["\n",(0,a.jsx)(e.li,{children:"for loop \u8b80\u53d6\u6578\u64da"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"# from_tensors\nfor data in dataset:\n    print(data)\n\n# from_tensor_slices\nfor data1, data2 in zip(x_data, y_data): # a list of tuples; http://puremonkey2010.blogspot.com/2015/10/python-python-zip.html\n    print(data1, data2)\n\n## python zip\nfor data1, data2 in zip(x_data, y_data):\n    print('x: {}, y: {}'.format(data1, data2))\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"4",children:["\n",(0,a.jsx)(e.li,{children:"take\uff1a\u8b80\u53d6\u8cc7\u6599 (dataset\u7684method)"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"for data in dataset.take(1):\n    print(data)\n\nfor data in dataset.take(2):  #take\u8d85\u904edataset\u7d44\u6578,\u9084\u662f\u53ea\u67091\u7d44\n    print(data)\n\nfor data1, data2 in zip(x_data.take(5), y_data.take(5)):\n    print('x: {}, y: {}'.format(data1, data2))\n\nfor data1, data2 in zip(x_data.take(12), y_data.take(12)):  #take\u8d85\u904edata1, data2\u7d44\u6578,\u9084\u662f\u53ea\u670910\u7d44\n    print('x: {}, y: {}'.format(data1, data2))\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"5",children:["\n",(0,a.jsx)(e.li,{children:"tf.data.Dataset.zip # \u7522\u751ftensor\u7684zip"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'dataset = tf.data.Dataset.zip((x_data, y_data)) # tuple\nprint(dataset,"\\n")\nfor data in dataset:\n    print(data)\n'})}),"\n",(0,a.jsxs)(e.ol,{start:"6",children:["\n",(0,a.jsx)(e.li,{children:"map\uff1a\u4f7f\u7528map\u4f86\u8f49\u63db\u6578\u64da"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"tf.data.Dataset.range(10) #tf.data.Dataset.from_tensor_slices(tf.constant([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])\ntf.data.Dataset.range(10).map(lambda x: x*2) #tf.data.Dataset.from_tensor_slices(tf.constant([0, 2, 4, 6, 8, 10, 12, 14, 16, 18])\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"7",children:["\n",(0,a.jsx)(e.li,{children:"\u547d\u540d\uff1a\u53ef\u4ee5\u5b57\u5178\u65b9\u5f0f\u70baelements\u7684\u7d44\u4ef6\u547d\u540d"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'x = tf.data.Dataset.range(10) #tf.data.Dataset.from_tensor_slices(tf.constant([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], shape=(10, )))\ny = tf.data.Dataset.range(10).map(lambda x: x*2) #tf.data.Dataset.from_tensor_slices(tf.constant([0, 2, 4, 6, 8, 10, 12, 14, 16, 18], shape=(10, )))\nprint(x)\nprint(y)\ndataset = tf.data.Dataset.zip((x, y)) #tuple\nprint(dataset)\ndataset = tf.data.Dataset.zip({"x": x, "y": y}) #dict\nprint(dataset)\n'})}),"\n",(0,a.jsxs)(e.ol,{start:"7",children:["\n",(0,a.jsx)(e.li,{children:"\u6279\u6b21\u53d6\u503c"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"dataset = tf.data.Dataset.zip({\"x\": x, \"y\": y}).batch(2)\nprint(dataset)\n\nfor data in dataset.take(5):\n  print(data)\n  print('x: {}, y: {}'.format(data['x'], data['y']))\n"})}),"\n",(0,a.jsxs)(e.ol,{start:"8",children:["\n",(0,a.jsx)(e.li,{children:"shuffle \u6253\u4e82\u8cc7\u6599"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"dataset = dataset.shuffle(5) # buffer size = 5  #\u9806\u5e8f\u6253\u4e82\nfor data in dataset.take(5):\n    print('x: {}, y: {}'.format(data['x'], data['y']))\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u4e0d\u8981\u4e00\u6b21\u5168\u90e8\u8cc7\u6599\u6253\u4e82\uff0c\uff32\uff21\uff2d\u6703\u4e0d\u5920\uff0c\u5148batch\u7136\u5f8cshuffle"}),"\n",(0,a.jsx)(e.h2,{id:"import-\u5fc5\u8981\u5957\u4ef6",children:"import \u5fc5\u8981\u5957\u4ef6"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"import tensorflow as tf\nfrom tensorflow import keras # tf.keras\nfrom tensorflow.keras import layers\n"})}),"\n",(0,a.jsx)(e.h2,{id:"sequential-model",children:"Sequential Model"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:"Sample Network"}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"# \u8f38\u5165\u70ba28x28 (\u62c9\u5e73\u70ba784\u7684\u4e00\u7dad\u5411\u91cf)\u7684\u5f71\u50cf\uff0c\u8f38\u51fa\u70ba10 (\u5206\u70ba\u5341\u500b\u985e\u5225)\nmodel = keras.Sequential(name='Sequential')\nmodel.add(layers.Dense(64, activation='relu', input_shape=(784,))) # \u7dda\u6027\u8f38\u5165 \u975e\u7dda\u6027\u8f38\u51fa\nmodel.add(layers.Dense(64, activation='relu')) # \u7b2c\u4e8c\u6b21 \u7dda\u6027\u8f38\u5165 \u975e\u7dda\u6027\u8f38\u51fa\nmodel.add(layers.Dense(10, activation='softmax'))  # output layer # \u6700\u5f8c\u8f38\u51fa\n"})}),"\n",(0,a.jsx)(e.h3,{id:"single-input-model-\u55ae\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",children:"Single input model: \u55ae\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"inputs = keras.Input(shape=(784,), name='Input')\nhidden1 = layers.Dense(64, activation='relu', name='hidden1')(inputs)\nhidden2 = layers.Dense(64, activation='relu', name='hidden2')(hidden1)\noutputs = layers.Dense(10, activation='softmax', name='Output')(hidden2)\n\nmodel = keras.Model(inputs=inputs, outputs=outputs)\n"})}),"\n",(0,a.jsx)(e.h3,{id:"multi-input-model-\u591a\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b",children:"Multi Input Model: \u591a\u8f38\u5165\u55ae\u8f38\u51fa\u6a21\u578b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"img_input = keras.Input(shape=(28, 28, 1), name='Image_Input')\ninfo_input = keras.Input(shape=(1, ), name='Information_Input')\n\nhidden1_1 = layers.Conv2D(64, kernel_size=5, strides=2, activation='relu', name='hidden1_1')(img_input)\nhidden1_2 = layers.Conv2D(32, kernel_size=5, strides=2, activation='relu', name='hidden1_2')(hidden1_1)\nhidden1_2_ft= layers.Flatten()(hidden1_2)\n\nhidden1_3 = layers.Dense(64, activation='relu', name='hidden1_3')(info_input)\n\nconcat = layers.Concatenate()([hidden1_2_ft, hidden1_3])\nhidden2 = layers.Dense(64, activation='relu', name='hidden2')(concat)\noutputs = layers.Dense(1, name='Output')(hidden2)\n\nmodel = keras.Model(inputs=[img_input, info_input], outputs=outputs)\n"})}),"\n",(0,a.jsx)(e.h3,{id:"multi-output-network-\u55ae\u8f38\u5165\u591a\u8f38\u51fa\u6a21\u578b",children:"Multi Output Network: \u55ae\u8f38\u5165\u591a\u8f38\u51fa\u6a21\u578b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"inputs = keras.Input(shape=(28, 28, 1), name='Input')\n\nhidden1 = layers.Conv2D(64, kernel_size=3, activation='relu', name='hidden1')(inputs)\nhidden2 = layers.Conv2D(64, kernel_size=3, strides=2, activation='relu', name='hidden2')(hidden1)\nhidden3 = layers.Conv2D(64, kernel_size=3, strides=2, activation='relu', name='hidden3')(hidden2)\nflatten = layers.Flatten()(hidden3)\n\nage_output = layers.Dense(1, name='Age_Output')(flatten)\ngender_output = layers.Dense(1, name='Gender_Output')(flatten)\n\nmodel = keras.Model(inputs=inputs, outputs=[age_output, gender_output])\n\n"})}),"\n",(0,a.jsx)(e.h3,{id:"multi-input-and-multi-output-network",children:"Multi Input and Multi Output Network"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"image_inputs = keras.Input(shape=(28, 28, 1), name='Image_Input')\nhidden1 = layers.Conv2D(64, kernel_size=3, activation='relu', name='hidden1')(image_inputs)\nhidden2 = layers.Conv2D(64, kernel_size=3, strides=2, activation='relu', name='hidden2')(hidden1)\nhidden3 = layers.Conv2D(64, kernel_size=3, strides=2, activation='relu', name='hidden3')(hidden2)\nflatten = layers.Flatten()(hidden3)\n\ninfo_inputs = keras.Input(shape=(10, ), name='Info_Input')\nhidden4 = layers.Dense(64)(info_inputs)\n\nconcat = layers.Concatenate()([flatten, hidden4])\n\nweather_outputs = layers.Dense(1, name='Output1')(concat)\ntemp_outputs = layers.Dense(1, name='Output2')(concat)\nhumidity_outputs = layers.Dense(1, name='Output3')(concat)\n\nmodel = keras.Model(inputs=[image_inputs, info_inputs],\n                    outputs=[weather_outputs, temp_outputs, humidity_outputs])\n"})})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>d,x:()=>r});var a=t(6540);const i={},s=a.createContext(i);function d(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);