"use strict";(self.webpackChunkxing_life_3=self.webpackChunkxing_life_3||[]).push([[6852],{2641:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>a});var t=r(4848),s=r(8453);const o={},c="Database\u3001SQL",d={id:"technique/database_sql/README",title:"Database\u3001SQL",description:"DBeaver",source:"@site/docs/technique/database_sql/README.md",sourceDirName:"technique/database_sql",slug:"/technique/database_sql/",permalink:"/docs/technique/database_sql/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"techniqueSidebar",previous:{title:"WebView",permalink:"/docs/technique/cordova/webview"},next:{title:"Analyze",permalink:"/docs/technique/database_sql/analyze"}},i={},a=[{value:"DBeaver",id:"dbeaver",level:2},{value:"windows function",id:"windows-function",level:2},{value:"sql select \u4e32\u63a5 concat",id:"sql-select-\u4e32\u63a5-concat",level:2},{value:"group rownumber",id:"group-rownumber",level:2},{value:"group concat in db2",id:"group-concat-in-db2",level:2},{value:"Next id value in db2",id:"next-id-value-in-db2",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"databasesql",children:"Database\u3001SQL"})}),"\n",(0,t.jsx)(n.h2,{id:"dbeaver",children:"DBeaver"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://dbeaver.io/",children:"https://dbeaver.io/"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"windows-function",children:"windows function"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ROW_NUMBER() OVER (ORDER BY joindate) \u2014 \u6392\u540d\u6216\u6392\u5e8f\u7528\nSUM(amount) OVER (PARTITION BY customer_id ORDER BY date) \u2014 \u7d2f\u7a4d\u52a0\u7e3d\nAVG(score) OVER (PARTITION BY class) \u2014 \u5e73\u5747\u6578\u8a08\u7b97\uff08\u5206\u7d44\uff09\nCOUNT(*) OVER () - \u8a08\u6578\u5168\u90e8\u6578\u91cf\n\n# \u5217\u51fa\u540d\u5b57\u540c\u6642\u6bcf\u7b46\u8cc7\u6599\u90fd\u9644\u4e0ausers\u7684\u6578\u91cf\nSELECT COUNT(*) OVER() as total, users.name\nFROM users\n# \u627e\u51fa\u5408\u8a08\u6700\u9ad8\u7684\u4e00\u7b46\nselect facid, total \nfrom (\n    select facid,\n    sum(slots) as total,\n    rank() over (order by sum(slots)desc) rank\n    from cd.bookings\n    group by facid\n) \nwhere rank = 1\n\n#\nselect \n    m.firstname,\n    m.surname,\n    round(sum(b.slots) * 0.5, -1) as hours,\n    rank() over(order by round(sum(b.slots) * 0.5, -1) desc) as rank\nfrom cd.members m\ninner join cd.bookings b on m.memid = b.memid\ngroup by m.memid\norder by rank, m.surname, m.firstname;\n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"sql-select-\u4e32\u63a5-concat",children:"sql select \u4e32\u63a5 concat"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"MySQL: CONCAT( )\nOracle: CONCAT( ), ||\nSQL Server: +\n"})}),"\n",(0,t.jsx)(n.h2,{id:"group-rownumber",children:"group rownumber"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"WITH\nUSER_SCOPE AS (\n\tSELECT ROW_NUMBER() OVER (PARTITION BY NAME ORDER BY AGE DESC) AS RANK_NO, *\n\tFROM USERS\n),\nYANGEST_USERS AS (\n\tSELECT * FROM USER_SCOPE WHERE RANK_NO = 1\n),\n"})}),"\n",(0,t.jsx)(n.h2,{id:"group-concat-in-db2",children:"group concat in db2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"SELECT\n\t\tITEM.ITEMNUM,\n\t\tLISTAGG(DISTINCT BAND_ITEMS.VENDOR,',')  WITHIN GROUP(ORDER BY VENDOR ASC)  AS BRAND_NAMES\n\tFROM\n\t\tITEM\n\tINNER JOIN BAND_ITEMS ON\n\t\tITEM.ITEMNUM = BAND_ITEMS.ITEMNUM\n\tGROUP BY\n\t\tITEM.ITEMNUM;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"next-id-value-in-db2",children:"Next id value in db2"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://www.ibm.com/docs/en/db2/11.5?topic=expressions-sequence-reference",children:"https://www.ibm.com/docs/en/db2/11.5?topic=expressions-sequence-reference"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"QQ: does not work.\n   INSERT INTO order(orderno, custno)\n     VALUES (NEXT VALUE FOR order_seq, 123456);\nor\n   UPDATE order\n     SET orderno = NEXT VALUE FOR order_seq\n     WHERE custno = 123456;\nor\n   VALUES NEXT VALUE FOR order_seq INTO :hv_seq;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"-- it can work\nINSERT INTO table(TABLE_ID, value)\n     VALUES (TABLE_IDSEQ.nextval, 'HelloWorld');\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>d});var t=r(6540);const s={},o=t.createContext(s);function c(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);